{"version":3,"sources":["webpack:///./src/app/pages/edmit-user/edmit-user.module.ts","webpack:///./src/app/pages/edmit-user/edmit-user.page.html","webpack:///./src/app/pages/edmit-user/edmit-user.page.scss","webpack:///./src/app/pages/edmit-user/edmit-user.page.ts"],"names":[],"mappings":"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","file":"pages-edmit-user-edmit-user-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { EdmitUserPage } from './edmit-user.page';\nimport {PipesModule} from \"../../pipes/pipes.module\";\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: EdmitUserPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    PipesModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [EdmitUserPage]\n})\nexport class EdmitUserPageModule {}\n","module.exports = \"<!--\\n * @Author: wjy\\n * @Date: 2019-08-03 14:52:31\\n * @LastEditors: wjy\\n * @LastEditTime: 2019-08-04 01:26:30\\n * @Description: file content\\n -->\\n<ion-header mode=\\\"ios\\\">\\n  <ion-toolbar mode=\\\"ios\\\">\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-button (click)=\\\"goBack()\\\">\\n        <ion-icon mode=\\\"ios\\\" name=\\\"arrow-back\\\"></ion-icon>\\n      </ion-button>\\n    </ion-buttons>\\n    <ion-title>修改资料</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content padding>\\n  <form #data=\\\"ngForm\\\" *ngIf=\\\"userData\\\" (ngSubmit)=\\\"onSubmit()\\\">\\n    <ion-list>\\n      <ion-item>\\n        <ion-label>用户名</ion-label>\\n        <ion-input text-end\\n           [(ngModel)]=\\\"userData.username\\\" name=\\\"username\\\" required></ion-input>\\n      </ion-item>\\n      <!--<ion-item>-->\\n        <!--<ion-label>手机号</ion-label>-->\\n        <!--<ion-input-->\\n           <!--[(ngModel)]=\\\"userData.mobile_phone\\\" name=\\\"mobile_phone\\\" required></ion-input>-->\\n      <!--</ion-item>-->\\n      <ion-item (click)=\\\"imgFrom()\\\" detail>\\n        <ion-avatar slot=\\\"end\\\">\\n          <img [src]=\\\"userData.headimg | imgsrc: http.domain\\\">\\n        </ion-avatar>\\n        <ion-label>头像</ion-label>\\n      </ion-item>\\n      <ion-item detail>\\n        <ion-label>生日</ion-label>\\n        <ion-datetime displayFormat=\\\"YYYY-MM-DD\\\"\\n                      pickerFormat=\\\"YYYY-MM-DD\\\"\\n                      Format=\\\"YYYY-MM-DD\\\" doneText=\\\"确定\\\" cancelText=\\\"取消\\\"\\n                      [(ngModel)]=\\\"userData.birthday\\\" name=\\\"birthday\\\"></ion-datetime>\\n      </ion-item>\\n      <ion-item>\\n        <ion-label>性别</ion-label>\\n        <ion-select  [(ngModel)]=\\\"userData.sex\\\" name=\\\"sex\\\" interface=\\\"action-sheet\\\">\\n          <ion-select-option value=\\\"1\\\">男</ion-select-option>\\n          <ion-select-option value=\\\"0\\\">女</ion-select-option>\\n        </ion-select>\\n      </ion-item>\\n      <!--<ion-radio-group [(ngModel)]=\\\"userData.sex\\\" name=\\\"sex\\\">-->\\n        <!--<ion-list-header>-->\\n          <!--性别-->\\n        <!--</ion-list-header>-->\\n        <!--<ion-item>-->\\n          <!--<ion-label>男</ion-label>-->\\n          <!--<ion-radio value=\\\"1\\\"></ion-radio>-->\\n        <!--</ion-item>-->\\n\\n        <!--<ion-item>-->\\n          <!--<ion-label>女</ion-label>-->\\n          <!--<ion-radio value=\\\"0\\\"></ion-radio>-->\\n        <!--</ion-item>-->\\n      <!--</ion-radio-group>-->\\n    </ion-list>\\n    <ion-button type=\\\"submit\\\" color=\\\"success\\\" expand=\\\"block\\\" [disabled]=\\\"!data.form.valid || isloading\\\" *ngIf=\\\"!data.form.pristine && !isupdate || ischangeHeadend\\\">提交</ion-button>\\n  </form>\\n\\n</ion-content>\\n\"","module.exports = \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL2VkbWl0LXVzZXIvZWRtaXQtdXNlci5wYWdlLnNjc3MifQ== */\"","/*\n * @Author: wjy\n * @Date: 2019-08-03 14:52:31\n * @LastEditors: wjy\n * @LastEditTime: 2019-08-04 01:36:43\n * @Description: file content\n */\nimport { Component, OnInit } from '@angular/core';\nimport {ActionSheetController, NavController} from \"@ionic/angular\";\nimport {UserService} from \"../../services/user.service\";\nimport {NativeService} from \"../../services/native.service\";\nimport {HttpService} from \"../../services/http.service\";\n\n@Component({\n  selector: 'app-edmit-user',\n  templateUrl: './edmit-user.page.html',\n  styleUrls: ['./edmit-user.page.scss'],\n})\nexport class EdmitUserPage implements OnInit {\n  userData: any;\n  isupdate: boolean; // 是否已上传数据\n  ischangeHead: boolean; // 是否正在上传图片\n  ischangeHeadend: boolean; // 是否改变图片\n  isloading: boolean; // 是否正在上传\n  constructor(private nav: NavController, private userfn: UserService,\n              private native: NativeService, public actionSheetController: ActionSheetController,\n              private http: HttpService) { }\n\n  ngOnInit() {\n    this.userfn.getUserp().then(res =>{\n      console.log(res);\n      this.userData = {\n        headimg: res.headimg,\n        username: res.user_name || res.username,\n        birthday: res.birthday,\n        // mobile_phone: res.mobile_phone,\n        sex: res.sex\n      }\n    }).catch(err => {})\n  }\n  goBack () {\n    this.nav.back();\n  }\n  async onSubmit() {\n    console.log(this.userData)\n    const userdata: any = Object.assign({}, this.userData);\n    if (!userdata.username) {\n      this.native.presentAlert('请输入用户名!');\n      return false;\n    }\n    this.isloading = true;\n    if (userdata.birthday.includes('T')) {\n      userdata.birthday = userdata.birthday.split('T')[0]\n      this.userData.birthday = userdata.birthday;\n    }\n    if (this.ischangeHead) {\n      return false;\n    }\n    // if (userdata.headimg.includes('data:image/jpeg;base64')) {\n    //   const file = this.native.getImgbase64tofile(userdata.headimg, userdata.username + 'pqtx');\n    //   try {\n    //     const filepath = await this.imgupload(file);\n    //     userdata.headimg = filepath;\n    //     this.userData.headimg = filepath;\n    //   } catch (err) {\n    //     this.native.presentAlert('图片上传失败，请稍后再试!')\n    //     return false;\n    //   }\n    // }\n    this.updateData(userdata);\n  }\n  /**\n   * @Author: wjy\n   * @description: 更新服务器用户数据\n   * @param {type} data 上传的用户数据\n   * @return: \n   * @Date: 2019-08-04 01:18:32\n   */\n  updateData(data: any) {\n    this.http.postformdataloading(this.http.editprofile, data).subscribe(res =>{\n      console.log(res);\n      this.isupdate = true;\n      this.userfn.upDataobj(data);\n      this.isloading = false;\n    }, error2 => {\n      this.isloading = false;\n    });\n  }\n  imgupload(file) {\n    return new Promise((resolve, reject) => {\n      const oReq = new XMLHttpRequest();\n      oReq.open('POST', this.http.domain + this.http.updateimg);\n      oReq.onreadystatechange = (oEvent) => {\n        if (oReq.readyState == 4 && oReq.status == 200) {\n          const res = JSON.parse(oReq.response)\n          resolve(res.result['src']);\n        }\n      }\n      oReq.onerror = (err) => {\n        reject(err);\n      }\n      oReq.send(file);\n    });\n  }\n  async imgFrom() {\n    const actionSheet = await this.actionSheetController.create({\n      buttons: [{\n        text: '拍摄照片',\n        handler: () => {\n          console.log('Delete clicked');\n          // this.route.navigate(['/fbpqimg']);\n          this.native.getPictureByCamera().then(filedata => {\n            if (!filedata) {\n              return false;\n            }\n            console.log(filedata)\n            // console.log()\n            this.changeHead(filedata);\n          });\n        }\n      }, {\n        text: '从手机相册选择',\n        handler: () => {\n          console.log('Share clicked');\n          this.native.getPictureByCamera({sourceType: 0}).then(filedata => {\n            if (!filedata) {\n              return false;\n            }\n            console.log(filedata)\n            this.changeHead(filedata);\n          });\n        }\n      }, {\n        text: '取消',\n        role: 'cancel',\n        handler: () => {\n          console.log('Cancel clicked');\n        }\n      }]\n    });\n    await actionSheet.present();\n  }\n  /**\n   * @Author: wjy\n   * @description: 预览头像\n   * @param {type} link 图片路径\n   * @return: \n   * @Date: 2019-08-04 01:13:02\n   */\n  private async changeHead(link: string) {\n    this.ischangeHead = true;\n    this.userData.headimg = link;\n    try {\n      const file = this.native.getImgbase64tofile(this.userData.headimg, this.userData.username + 'userhead' + this.userData.user_id);\n      console.log(file);\n      const filepath = await this.imgupload(file);\n      this.userData.headimg = filepath;\n      this.ischangeHead = false;\n      if (this.isloading) {\n        this.onSubmit();\n      }\n    } catch (err) {\n      this.native.presentAlert('图片上传失败，请重新选择!');\n      this.ischangeHead = false;\n      if (this.isloading) {\n        this.isloading = false;\n      }\n      return false;\n    }\n  }\n}\n"],"sourceRoot":""}